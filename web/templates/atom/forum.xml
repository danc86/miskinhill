<?xml version="1.0" encoding="UTF-8" ?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:py="http://genshi.edgewall.org/">

<?python
forum = node
posts = sorted(forum.reflexive('sioc:has_container'), key=lambda p: p['dc:created'], reverse=True)
# XXX <updated>? for now, assuming never
?>

<id>${forum.uri}</id>
<title type="text">${forum['dc:title']}</title>
<link rel="self" type="application/atom+xml" href="${forum.uri}.atom" />
<link rel="alternate" href="${forum.uri}" />
<updated>${posts[0]['dc:created'].isoformat()}</updated>

<entry py:for="post in posts"
       py:with="content = post['sioc:content']">
    <id>${post.uri}</id>
    <author><name>Miskin Hill</name></author>
    <published>${post['dc:created'].isoformat()}</published>
    <updated>${post['dc:created'].isoformat()}</updated>
    <title type="text">${post['dc:title']}</title>
    <py:if test="content['awol:type'] == 'application/xhtml+xml'">
        <content type="xhtml">${Markup(content['awol:body'])}</content>
    </py:if>
</entry>

</feed>
