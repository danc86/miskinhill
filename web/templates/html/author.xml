<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      lang="en-AU">
<xi:include href="_commonwrapper.xml" />

<?python
from viewutils import relative_url
import representations
import rdfob
author = node
articles = [a for a in author.reflexive('dc:creator', type='mhs:Article') if a.uri.startswith('http://miskinhill.com.au/')]
reviews = [r for r in author.reflexive('dc:creator', type='mhs:Review') if r.uri.startswith('http://miskinhill.com.au/')]
obituaries = [r for r in author.reflexive('dc:creator', type='mhs:Obituary') if r.uri.startswith('http://miskinhill.com.au/')]
translations = [t for t in author.reflexive('mhs:translator') if t.uri.startswith('http://miskinhill.com.au/')]
?>

<head>
    <title>${author['foaf:name']}</title>
    <py:for each="r in representations.for_types(node.types)" py:if="r.format != 'html'">
        ${r(req, node).link()}
    </py:for>
    <link rel="stylesheet" type="text/css" href="/style/author.css" />
</head>

<body>

<h2>${author['foaf:name']}<abbr class="unapi-id" title="${author.uri}" /></h2>

<div class="metabox-container">
    <div class="author-meta metabox">
        <h4>Author details</h4>
        <p class="affiliation" py:if="'mhs:isAffiliatedWith' in author">Affiliated with <a href="${author['mhs:isAffiliatedWith'].uri}">${author['mhs:isAffiliatedWith']['foaf:name']}</a></p>
        <p class="metadata-links">Metadata:
            ${Markup(u', ').join(r(req, node).anchor() for r in representations.for_types(node.types) if r.format != 'html')}
        </p>
    </div>
</div>

<p py:if="'mhs:biographicalNotes' in author">${author['mhs:biographicalNotes']}</p>

<py:if test="articles">
    <h3>Articles</h3>
    <ul class="articles">
        <li py:for="article in sorted(articles, key=lambda a: a['dc:isPartOf']['mhs:publicationDate'], reverse=True)"
            py:with="issue = article['dc:isPartOf']; journal = issue['mhs:isIssueOf']">
            <div class="article"><a href="${relative_url(article.uri)}">${article['dc:title']}</a></div>
            <div class="issue">in <a href="${relative_url(issue.uri)}"><em>${journal['dc:title']}</em> Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']} (${issue['dc:coverage']})</a></div>
        </li>
    </ul>
</py:if>

<py:if test="reviews">
    <h3>Reviews</h3>
    <ul class="reviews">
        <li py:for="review in sorted(reviews, key=lambda r: (r['dc:isPartOf']['mhs:publicationDate'], r['mhs:startPage']), reverse=True)"
            py:with="book = review['mhs:reviews']; issue = review['dc:isPartOf']; journal = issue['mhs:isIssueOf']">
            <div class="book"><a href="${relative_url(review.uri)}">${', '.join(book.getall('dc:creator'))}, <em>${book['dc:title']}</em> (${str(book['dc:date'])[:4]})</a></div>
            <div class="issue">in <a href="${relative_url(issue.uri)}"><em>${journal['dc:title']}</em> Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']} (${issue['dc:coverage']})</a></div>
        </li>
    </ul>
</py:if>

<py:if test="obituaries">
    <h3>Obituaries</h3>
    <ul class="obituaries">
        <li py:for="obituary in sorted(obituaries, key=lambda r: (r['dc:isPartOf']['mhs:publicationDate'], r['mhs:startPage']), reverse=True)"
            py:with="issue = obituary['dc:isPartOf']; journal = issue['mhs:isIssueOf']">
            <div class="book"><a href="${relative_url(obituary.uri)}">${obituary['dc:title']}</a></div>
            <div class="issue">in <a href="${relative_url(issue.uri)}"><em>${journal['dc:title']}</em> Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']} (${issue['dc:coverage']})</a></div>
        </li>
    </ul>
</py:if>

<py:if test="translations">
    <h3>Translations</h3>
    <ul class="translations">
        <li py:for="translation in sorted(translations, key=lambda t: t['dc:isPartOf']['mhs:publicationDate'], reverse=True)"
            py:with="issue = translation['dc:isPartOf']; journal = issue['mhs:isIssueOf']">
            <py:choose>
                <py:when test="rdfob.uriref('mhs:Article') in translation.types">
                    <div class="article"><a href="${relative_url(translation.uri)}">${translation['dc:title']}</a></div>
                    <div class="author">by <a href="${relative_url(translation['dc:creator'].uri)}">${translation['dc:creator']['foaf:name']}</a></div>
                </py:when>
                <py:when test="rdfob.uriref('mhs:Review') in translation.types">
                    <div class="book"><a py:with="book = translation['mhs:reviews']" href="${relative_url(translation.uri)}">Review of ${', '.join(book.getall('dc:creator'))}, <em>${book['dc:title']}</em> (${str(book['dc:date'])[:4]})</a></div>
                    <div class="reviewed-by">Reviewed by <a href="${relative_url(translation['dc:creator'].uri)}">${translation['dc:creator']['foaf:name']}</a></div>
                </py:when>
            </py:choose>
            <div class="issue">in <a href="${relative_url(issue.uri)}"><em>${journal['dc:title']}</em> Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']} (${issue['dc:coverage']})</a></div>
        </li>
    </ul>
</py:if>

</body>
</html>
