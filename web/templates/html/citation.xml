<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      lang="en-AU">
<xi:include href="_commonwrapper.xml" />
<xi:include href="_bookinfo.xml" />
<xi:include href="_articleinfo.xml" />

<?python
from viewutils import relative_url
import citations
import representations
import rdfob
citation_node = node
citation = citations.Citation.from_markup(citation_node['mhs:citationMarkup'])
article = citation_node['dc:isPartOf']
issue = article['dc:isPartOf']
journal = issue['mhs:isIssueOf']
?>

<head>
    <title>Citation - ${Markup(article['dc:title']).striptags()} - ${journal['dc:title']} Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']}</title><!-- XXX way too long? -->
    <link rel="stylesheet" type="text/css" href="/style/citation.css" />
</head>

<body>

${breadcrumbs([('/journals/', 'Journals'), 
               (relative_url(journal.uri), journal['dc:title']),
               (relative_url(issue.uri), 'Vol. %s, Issue %s' % (issue['mhs:volume'], issue['mhs:issueNumber'])), 
               (relative_url(article.uri), article['dc:title'])])}

<h2>Citation<abbr class="unapi-id" title="${citation_node.uri}" /></h2>

<py:if test="citation_node.getone('mhs:cites', None)" py:with="cited = citation_node['mhs:cites']">
    <py:choose>
        <py:when test="rdfob.uriref('mhs:Book') in cited.types">${bookinfo(cited)}</py:when>
        <py:when test="rdfob.uriref('mhs:Article') in cited.types">${articleinfo(cited)}</py:when>
    </py:choose>
</py:if>

<div>${citation.coins(as_markup=True)}</div>

<p>Cited as: ${citation_node['mhs:citationMarkup']}</p>

</body>
</html>
