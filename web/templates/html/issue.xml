<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      lang="en-AU">
<xi:include href="_commonwrapper.xml" />

<?python
from viewutils import relative_url
issue = node
journal = issue['mhs:isIssueOf']
?>

<head>
    <title>${journal['dc:title']} Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']}</title>
    <link rel="stylesheet" type="text/css" href="/style/issue.css" />
</head>

<body>

${breadcrumbs([('/journals/', 'Journals'), 
               (relative_url(journal.uri), journal['dc:title'])])}

<h2>
    <span class="journal-title">${journal['dc:title']}</span>
    <span class="issue">Vol. ${issue['mhs:volume']}, Issue ${issue['mhs:issueNumber']} (${issue['dc:coverage']})</span>
    <abbr class="unapi-id" title="${issue.uri}" />
</h2>

<div class="metabox-container">
    ${searchbox(issue)}

    <div class="issue-meta metabox">
        <h4>Issue details</h4>
        <p class="cover"><img src="${issue.getone('mhs:coverThumbnail', as_uriref=True)}" alt="" /></p>
        <p>Published ${issue['mhs:publicationDate'].strftime('%d %B %Y')}</p>
        <p>Metadata: <a href="${relative_url(issue.uri)}.nt">RDF</a></p>
    </div>
</div>

<h3>Articles</h3>
<ul class="contents articles">
    <li py:for="article in sorted(issue.reflexive('dc:isPartOf', type='mhs:Article'), key=lambda a: a['mhs:startPage'])"
        py:with="author = article['dc:creator']">
        <div class="title"><a href="${relative_url(article.uri)}">${article['dc:title']}</a></div>
        <div class="author">by <a href="${relative_url(author.uri)}">${author['foaf:name']}</a></div>
    </li>
</ul>

<h3>Reviews</h3>
<ul class="contents reviews">
    <li py:for="review in sorted(issue.reflexive('dc:isPartOf', type='mhs:Review'), key=lambda r: r['mhs:startPage'])"
        py:with="author = review['dc:creator']; book = review['mhs:reviews']">
        <div class="book"><a href="${relative_url(review.uri)}">${book['dc:creator']}, <em>${book['dc:title']}</em> (${book['dc:date'][:4]})</a></div>
        <div class="reviewed-by">Reviewed by <a href="${relative_url(author.uri)}">${author['foaf:name']}</a></div>
    </li>
</ul>

</body>
</html>
