<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      lang="en-AU">
<!-- XXX xi:include href="_commonwrapper.xml" /-->

<?python
import urllib
from viewutils import relative_url
book = node
isbn = book.identifier('urn:isbn:')
asin = book.identifier('urn:asin:')
gbooksid = book.identifier('http://books.google.com/books?id=')

links = []
if asin:
    links.append(('http://www.amazon.com/dp/%s/?tag=mishil-20' % asin, 'Amazon.com'))
if isbn:
    links.append(('http://openlibrary.org/search?q=isbn_13:%s' % isbn, 'Open Library'))
if gbooksid:
    links.append(('http://books.google.com/books?id=%s' % gbooksid, 'Google Book Search'))
elif isbn:
    links.append(('http://books.google.com/books?vid=ISBN%s' % isbn, 'Google Book Search'))
else:
    links.append(('http://books.google.com/books?q=%s' % urllib.quote(book['dc:title'].encode('utf8'), ''), 'Google Book Search'))
if isbn:
    links.append(('http://www.worldcat.org/search?q=isbn:%s' % isbn, 'WorldCat'))
if isbn:
    links.append(('http://www.librarything.com/isbn/%s' % isbn, 'LibraryThing'))
?>

<head>
</head>

<body>

<p class="cover" py:if="asin"><img src="http://images.amazon.com/images/P/${asin}.01.MZZZZZZZ.jpg" alt="" /></p>

<div class="beside">
    <p class="main"><em>${book['dc:title']}</em><br />by ${', '.join(book.getall('dc:creator'))}</p>
    <p class="publication" py:with="publisher = book.getone('dc:publisher', default=None); date = book.getone('dc:date', default=None)">
        <py:if test="publisher or date">
            Published <py:if test="publisher">by ${publisher}</py:if><py:if test="publisher and date">, </py:if><py:if test="date">${date}</py:if><br />
        </py:if>
        <py:if test="isbn">ISBN ${isbn}</py:if>
    </p>
    <p class="links">Find this book online:<br />
        <py:for each="n, (url, anchor) in enumerate(links)">
            <a href="${url}">${anchor}</a><py:if test="n &lt; len(links) - 1">,</py:if>
        </py:for>
    </p>
</div>

</body>
</html>
